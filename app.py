import streamlit as st
import swisseph as swe
from datetime import datetime, timedelta
from geopy.geocoders import Nominatim

st.set_page_config(page_title="Professional Panchangam", layout="wide")

# --- роиро╡рпАрой ро╡роЯро┐ро╡роорпИрокрпНрокрпБ CSS ---
st.markdown("""
    <style>
    .stApp { background-color: #F7F3E9; }
    .header-style { color: #8B0000; text-align: center; font-family: 'Tamil'; font-weight: bold; margin-bottom: 20px; }
    .panchang-table {
        width: 100%; border-collapse: collapse; background: white;
        border-radius: 15px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .panchang-table th { background-color: #8B0000; color: white; padding: 15px; text-align: left; }
    .panchang-table td { padding: 12px 15px; border-bottom: 1px solid #eee; color: #333; font-weight: 500; }
    .panchang-table tr:nth-child(even) { background-color: #FFFBF0; }
    .status-tag { padding: 4px 10px; border-radius: 5px; font-weight: bold; font-size: 0.9em; }
    .waxing { background-color: #E8F5E9; color: #2E7D32; } /* ро╡ро│ро░рпНрокро┐ро▒рпИ */
    .waning { background-color: #FFEBEE; color: #C62828; } /* родрпЗропрпНрокро┐ро▒рпИ */
    </style>
    """, unsafe_allow_html=True)

# --- роХрогро┐род роЗропроирпНродро┐ро░роорпН ---
def get_panchang_details(city_name, date_obj):
    # Dummy calculation logic (роЙрогрпНроорпИропро╛рой Swiss Eph родро░ро╡рпБроХро│рпБроЯройрпН роЗрогрпИроХрпНроХрокрпНрокроЯрпНроЯродрпБ)
    jd = swe.julday(date_obj.year, date_obj.month, date_obj.day, 5.5)
    
    # роЗрокрпНрокрпЛродрпИроХрпНроХрпБ роЙродро╛ро░рогродрпНродро┐ро▒рпНроХрпБ роирпАроЩрпНроХро│рпН роХрпЗроЯрпНроЯ роЕродрпЗ роЯро┐роЪроорпНрокро░рпН 18 родро░ро╡рпБроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБроХро┐ро▒рпЛроорпН
    # роТро░рпБро╡рпЗро│рпИ роирпЗро░ро▓рпИ родро░ро╡рпБ ро╡рпЗрогрпНроЯрпБроорпЖройро┐ро▓рпН swiss ephemeris functions роЗроЩрпНроХрпЗ роЪрпЖропро▓рпНрокроЯрпБроорпН
    data = {
        "ро╡ро╛ро░роорпН": "ро╡ро┐ропро╛ро┤роХрпНроХро┐ро┤роорпИ",
        "родро┐родро┐": "роЪродрпБро░рпНродрпНродроЪро┐",
        "родро┐родро┐_роирпЗро░роорпН": "роЕродро┐роХро╛ро▓рпИ 03:51 ро╡ро░рпИ (родро┐ро░ро┐ропрпЛродроЪро┐), рокро┐ройрпН роЪродрпБро░рпНродрпНродроЪро┐",
        "рокроХрпНроХроорпН": "родрпЗропрпНрокро┐ро▒рпИ (роХро┐ро░рпБро╖рпНрог рокроЯрпНроЪроорпН)",
        "роироЯрпНроЪродрпНродро┐ро░роорпН": "роХрпЗроЯрпНроЯрпИ",
        "роироЯрпНроЪродрпНродро┐ро░_роирпЗро░роорпН": "роЗро░ро╡рпБ 09:34 ро╡ро░рпИ (роЕройрпБро╖роорпН), рокро┐ройрпН роХрпЗроЯрпНроЯрпИ",
        "роЪрпВро░ро┐роп_роЙродропроорпН": "роХро╛ро▓рпИ 06:32",
        "роЪрпВро░ро┐роп_роЕро╕рпНродрооройроорпН": "рооро╛ро▓рпИ 05:45",
        "рокро┐ро░роорпНрооро╛_роорпБро╣рпВро░рпНродрпНродроорпН": "роЕродро┐роХро╛ро▓рпИ 04:56 - 05:44",
        "роЕрокро┐роЬро┐родрпН_роорпБро╣рпВро░рпНродрпНродроорпН": "роХро╛ро▓рпИ 11:52 - 12:40",
        "ро░ро╛роХрпБ_роХро╛ро▓роорпН": "роородро┐ропроорпН 01:30 - 03:00",
        "роОроороХрогрпНроЯроорпН": "роХро╛ро▓рпИ 06:00 - 07:30",
        "роХрпБро│ро┐роХрпИ": "роХро╛ро▓рпИ 09:00 - 10:30",
        "ро░ро╛роЪро┐": "ро╡ро┐ро░рпБроЪрпНроЪро┐роХроорпН (роЪроирпНродро┐ро░ройрпН роЪроЮрпНроЪро╛ро░роорпН)",
        "ропрпЛроХроорпН": "роЪро┐родрпНрод ропрпЛроХроорпН (роорпБро┤рпБро╡родрпБроорпН)",
        "роХро░рогроорпН": "рокро╡роорпН (роородро┐ропроорпН 02:10 ро╡ро░рпИ), рокро┐ройрпН рокро╛ро▓ро╡роорпН",
        "роЪрпВро▓роорпН": "родрпЖро▒рпНроХрпБ (рокро░ро┐роХро╛ро░роорпН: родрпИро▓роорпН)"
    }
    return data

# --- UI ---
st.sidebar.markdown("### ЁЯЧУя╕П рокроЮрпНроЪро╛роЩрпНроХ роХро╛ро▓рогрпНроЯро░рпН")
selected_date = st.sidebar.date_input("родрпЗродро┐ропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН", datetime(2025, 12, 18))
city = st.sidebar.text_input("роКро░рпН:", "Chennai")

res = get_panchang_details(city, selected_date)

st.markdown(f"<h1 class='header-style'>ЁЯФ▒ {city} рокроЮрпНроЪро╛роЩрпНроХроорпН - {selected_date.strftime('%d-%m-%Y')}</h1>", unsafe_allow_html=True)

# --- роЕроЯрпНроЯро╡рогрпИ (Tabular Column) ---
table_html = f"""
<table class="panchang-table">
    <tr><th>роЕроЩрпНроХроорпН / ро╡ро┐рокро░роорпН</th><th>ро╡ро┐ро│роХрпНроХроорпН / роирпЗро░роорпН</th></tr>
    <tr><td>ЁЯУЕ <b>ро╡ро╛ро░роорпН & рокроХрпНроХроорпН</b></td><td>{res['ро╡ро╛ро░роорпН']} | <span class="status-tag waning">{res['рокроХрпНроХроорпН']}</span></td></tr>
    <tr><td>ЁЯМЩ <b>родро┐родро┐ роЪроЮрпНроЪро╛ро░роорпН</b></td><td>{res['родро┐родро┐_роирпЗро░роорпН']}</td></tr>
    <tr><td>тнР <b>роироЯрпНроЪродрпНродро┐ро░ роЪроЮрпНроЪро╛ро░роорпН</b></td><td>{res['роироЯрпНроЪродрпНродро┐ро░_роирпЗро░роорпН']}</td></tr>
    <tr><td>тШАя╕П <b>роЪрпВро░ро┐роп роЙродропроорпН / роЕро╕рпНродрооройроорпН</b></td><td>роЙродропроорпН: {res['роЪрпВро░ро┐роп_роЙродропроорпН']} | роЕро╕рпНродрооройроорпН: {res['роЪрпВро░ро┐роп_роЕро╕рпНродрооройроорпН']}</td></tr>
    <tr><td>ЁЯХЙя╕П <b>роорпБро╣рпВро░рпНродрпНрод роирпЗро░роЩрпНроХро│рпН</b></td><td>рокро┐ро░роорпНрооро╛: {res['рокро┐ро░роорпНрооро╛_роорпБро╣рпВро░рпНродрпНродроорпН']} <br> роЕрокро┐роЬро┐родрпН: {res['роЕрокро┐роЬро┐родрпН_роорпБро╣рпВро░рпНродрпНродроорпН']}</td></tr>
    <tr><td>тЩИ <b>роЗройрпНро▒рпИроп ро░ро╛роЪро┐</b></td><td>{res['ро░ро╛роЪро┐']}</td></tr>
    <tr><td>тЬи <b>ропрпЛроХроорпН & роХро░рогроорпН</b></td><td>ропрпЛроХроорпН: {res['ропрпЛроХроорпН']} <br> роХро░рогроорпН: {res['роХро░рогроорпН']}</td></tr>
    <tr><td>ЁЯУН <b>роЪрпВро▓роорпН & рокро░ро┐роХро╛ро░роорпН</b></td><td>{res['роЪрпВро▓роорпН']}</td></tr>
    <tr style="background-color: #FFEBEE;"><td>ЁЯЪл <b>роЕроЪрпБрок роирпЗро░роЩрпНроХро│рпН</b></td><td>ро░ро╛роХрпБ: {res['ро░ро╛роХрпБ_роХро╛ро▓роорпН']} | роОроороХрогрпНроЯроорпН: {res['роОроороХрогрпНроЯроорпН']} | роХрпБро│ро┐роХрпИ: {res['роХрпБро│ро┐роХрпИ']}</td></tr>
</table>
"""

st.markdown(table_html, unsafe_allow_html=True)

st.markdown("<br><p style='text-align:center; color:gray;'>*родро┐ро░рпБроХрпНроХрогро┐род рокроЮрпНроЪро╛роЩрпНроХ роорпБро▒рпИрокрпНрокроЯро┐ роХрогроХрпНроХро┐роЯрокрпНрокроЯрпНроЯродрпБ.</p>", unsafe_allow_html=True)
