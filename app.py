import streamlit as st
import swisseph as swe
from datetime import datetime, timedelta
from geopy.geocoders import Nominatim

# роЖрокрпН роЯро┐роЪрпИройрпН
st.set_page_config(page_title="Astro Guide Calendar", layout="wide")

# --- CSS ро╡роЯро┐ро╡роорпИрокрпНрокрпБ ---
st.markdown("""
    <style>
    .stApp { background-color: #F9F7F2; }
    .header-style { color: #800000; text-align: center; font-family: 'Tamil'; font-weight: 900; padding: 10px; }
    .glass-card {
        background: white; padding: 25px; border-radius: 20px;
        border-top: 5px solid #D4AF37;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px;
    }
    .info-label { color: #5D4037; font-weight: bold; }
    .info-value { color: #1B5E20; font-size: 1.4em; font-weight: 800; }
    </style>
    """, unsafe_allow_html=True)

# --- рокроЮрпНроЪро╛роЩрпНроХроХрпН роХрогро┐родроорпН ---
def get_panchang(date_obj):
    # родро┐ро░рпБроХрпНроХрогро┐род роорпБро▒рпИрокрпНрокроЯро┐ 5:30 AM IST
    jd = swe.julday(date_obj.year, date_obj.month, date_obj.day, 5.5)
    swe.set_sid_mode(swe.SIDM_LAHIRI)
    
    m_pos = swe.calc_ut(jd, swe.MOON, swe.FLG_SIDEREAL)[0][0]
    s_pos = swe.calc_ut(jd, swe.SUN, swe.FLG_SIDEREAL)[0][0]
    
    naks = ["роЕро╕рпНро╡ро┐ройро┐", "рокро░рогро┐", "роХро╛ро░рпНродрпНродро┐роХрпИ", "ро░рпЛроХро┐рогро┐", "рооро┐ро░рпБроХроЪрпАро░ро┐роЯроорпН", "родро┐ро░рпБро╡ро╛родро┐ро░рпИ", "рокрпБройро░рпНрокрпВроЪроорпН", "рокрпВроЪроорпН", "роЖропро┐ро▓рпНропроорпН", "роороХроорпН", "рокрпВро░роорпН", "роЙродрпНродро┐ро░роорпН", "роЕро╕рпНродроорпН", "роЪро┐родрпНродро┐ро░рпИ", "роЪрпБро╡ро╛родро┐", "ро╡ро┐роЪро╛роХроорпН", "роЕройрпБро╖роорпН", "роХрпЗроЯрпНроЯрпИ", "роорпВро▓роорпН", "рокрпВро░ро╛роЯроорпН", "роЙродрпНродро┐ро░ро╛роЯроорпН", "родро┐ро░рпБро╡рпЛрогроорпН", "роЕро╡ро┐роЯрпНроЯроорпН", "роЪродропроорпН", "рокрпВро░роЯрпНроЯро╛родро┐", "роЙродрпНродро┐ро░роЯрпНроЯро╛родро┐", "ро░рпЗро╡родро┐"]
    tithis = ["рокро┐ро░родроорпИ", "родрпБро╡ро┐родро┐ропрпИ", "родро┐ро░рпБродро┐ропрпИ", "роЪродрпБро░рпНродрпНродро┐", "рокроЮрпНроЪрооро┐", "роЪро╖рпНроЯро┐", "роЪрокрпНродрооро┐", "роЕро╖рпНроЯрооро┐", "роиро╡рооро┐", "родроЪрооро┐", "роПроХро╛родроЪро┐", "родрпБро╡ро╛родроЪро┐", "родро┐ро░ропрпЛродроЪро┐", "роЪродрпБро░рпНродроЪро┐", "рокрпМро░рпНрогрооро┐", "рокро┐ро░родроорпИ (родрпЗропрпНрокро┐ро▒рпИ)", "родрпБро╡ро┐родро┐ропрпИ", "родро┐ро░рпБродро┐ропрпИ", "роЪродрпБро░рпНродрпНродро┐", "рокроЮрпНроЪрооро┐", "роЪро╖рпНроЯро┐", "роЪрокрпНродрооро┐", "роЕро╖рпНроЯрооро┐", "роиро╡рооро┐", "родроЪрооро┐", "роПроХро╛родроЪро┐", "родрпБро╡ро╛родроЪро┐", "родро┐ро░ропрпЛродроЪро┐", "роЪродрпБро░рпНродроЪро┐", "роЕрооро╛ро╡ро╛роЪрпИ"]
    
    nak_idx = int(m_pos / (360/27))
    tithi_idx = int(((m_pos - s_pos) % 360) / 12)
    
    return naks[nak_idx], tithis[tithi_idx]

# --- рокро┐ро░родро╛рой рокроХрпНроХроорпН ---
st.markdown("<h1 class='header-style'>ЁЯУЕ роЕро╕рпНроЯрпНро░рпЛ роХро╛ро▓рогрпНроЯро░рпН рокроЮрпНроЪро╛роЩрпНроХроорпН</h1>", unsafe_allow_html=True)

# роХро╛ро▓рогрпНроЯро░рпН родрпЗро░рпНро╡рпБ (Sidebar роЕро▓рпНро▓родрпБ Main-ро▓рпН ро╡рпИроХрпНроХро▓ро╛роорпН)
st.sidebar.markdown("### ЁЯЧУя╕П родрпЗродро┐ропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН")
selected_date = st.sidebar.date_input("", value=datetime(2025, 12, 18))

# роХрогроХрпНроХрпАроЯрпБ
nak, tithi = get_panchang(selected_date)

# ро╡ро┐рокро░роЩрпНроХро│рпИроХрпН роХро╛роЯрпНроЯрпБродро▓рпН
st.info(f"родрпЗро░рпНро╡рпБ роЪрпЖропрпНропрокрпНрокроЯрпНроЯ родрпЗродро┐: {selected_date.strftime('%d-%m-%Y')}")

col1, col2 = st.columns(2)

with col1:
    st.markdown(f"""
    <div class="glass-card">
        <p class="info-label">ЁЯМЩ роЗройрпНро▒рпИроп родро┐родро┐:</p>
        <p class="info-value">{tithi}</p>
        <hr>
        <p class="info-label">тнР роЗройрпНро▒рпИроп роироЯрпНроЪродрпНродро┐ро░роорпН:</p>
        <p class="info-value">{nak}</p>
    </div>
    """, unsafe_allow_html=True)

with col2:
    st.markdown(f"""
    <div class="glass-card">
        <p class="info-label">тМЫ роиро▓рпНро▓ роирпЗро░роорпН:</p>
        <p class="info-value" style="color:#D84315;">роХро╛ро▓рпИ 10:45 - 11:45</p>
        <hr>
        <p class="info-label">тЬи ропрпЛроХроорпН:</p>
        <p class="info-value">роЪро┐родрпНрод ропрпЛроХроорпН</p>
    </div>
    """, unsafe_allow_html=True)
